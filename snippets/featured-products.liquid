
<script>
  async function initProductRecommendations ()  {
    const sectionId = '{{ section.id }}';
    const baseUrl = '{{ routes.product_recommendations_url }}';
    const productId = {{ product.id }};
    const limit = 8;
    const intent = 'related';

    const url = `${baseUrl}?section_id=${sectionId}&product_id=${productId}&limit=${limit}&intent=${intent}`;

    const response = await fetch(url);
    const data = await response.text();

    document.querySelector('#featured-products-{{ section.id }}')
      .closest('.shopify-section').outerHTML = data;
  }

  window.addEventListener('DOMContentLoaded', () => {
    initProductRecommendations();
  });

  document.addEventListener('shopify:section:load', (e) => {
    if (e.target.querySelector('.featured-products')) {
      initProductRecommendations();
    }
  });
</script>

  <div 
    class="container"
    style="max-width: {{ section.settings.container_max_width | append: 'px' }};">
    <div class="swiper mx-n4 mx-desktop-n5 mt-n3 mt-desktop-n5">
      <div class="swiper-wrapper">
        {% if section.settings.recommended_mode and request.path contains 'recommendations' %}
          {% for product in recommendations.products %}
            <div class="swiper-slide p-4 p-desktop-5">
              {% render 'product-card', product: product %}
            </div>
          {% endfor %}
        {% elsif products == blank %}
          {{ empty_state }}
        {% else %}
          {% for product in products limit: section.settings.limit %}
            <div class="swiper-slide p-4 p-desktop-5">
              {% render 'product-card', product: product %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
      <div class="swiper-controls">
        <div class="swiper-pagination"></div>
        <div class="swiper-scrollbar"></div>
        <div class="swiper-button-prev">
          {% render 'svg-icons', icon: 'chevron-left', size: 24 %}
        </div>
        <div class="swiper-button-next">
          {% render 'svg-icons', icon: 'chevron-right', size: 24 %}
        </div>
      </div>
    </div>
  </div>

