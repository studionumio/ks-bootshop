
{% liquid 
  assign pt = block.settings.pt | prepend: 'pt-'
  assign pb = block.settings.pb | prepend: 'pb-'
%}
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Add event listeners to each radio button
  document.querySelectorAll('input[type="radio"][name^="option-"]').forEach(function (radioButton) {
    radioButton.addEventListener('change', function () {
      // Get the selected variant ID
      var selectedVariantId = this.getAttribute('data-variant-id');

      // Find the price for the selected variant
      var selectedPriceElement = document.querySelector('.variant-price[data-variant-id="' + selectedVariantId + '"]');

      // Get the sale price and compare price (if applicable)
      var newPrice = selectedPriceElement.querySelector('.product-price-final-sale') || selectedPriceElement;
      var comparePrice = selectedPriceElement.querySelector('.product-price-compare');

      // Update the main price display
      var currentPriceElement = document.getElementById('current-variant-price');
      var currentCompareElement = document.getElementById('current-compare-price');

      currentPriceElement.innerHTML = newPrice.innerHTML;

      // Update the compare price if it exists
      if (comparePrice) {
        if (currentCompareElement) {
          currentCompareElement.innerHTML = comparePrice.innerHTML;
          currentCompareElement.style.display = 'inline';
        } else {
          var compareHTML = '<s id="current-compare-price">' + comparePrice.innerHTML + '</s>';
          currentPriceElement.insertAdjacentHTML('afterend', compareHTML);
        }
      } 
      }
    });
  });

  // Trigger the change event on the currently selected option to update the prices initially
  var selectedRadio = document.querySelector('input[type="radio"][name^="option-"]:checked');
  if (selectedRadio) {
    selectedRadio.dispatchEvent(new Event('change'));
  }
});

</script>
{% unless product.has_only_default_variant %}
  <ul 
    class="product-options list-unstyled mb-0 {{ pt }} {{ pb }}"
    aria-label="{{ 'product.product_options' | t }}">
    {% for option in product.options_with_values %}
      <li class="py-3">
        {% if block.settings.options_style == 'buttons' %}
          <p class="mb-1">
            {{ option.name }}
          </p>
          <ul class="size-buttons list-unstyled">
            {% for value in option.values %}
              {% assign variant = product.variants | where: 'option1', value | first %}
              <li>
                <input 
                  class="visually-hidden" 
                  type="radio" 
                  name="option-{{ option.name | handleize }}" 
                  id="option-{{ option.name | handleize }}-{{ value | handleize }}" 
                  value="{{ value | escape }}"
                  {% if option.selected_value == value %}checked{% endif %}
                  data-variant-id="{{ variant.id }}">
                <label for="option-{{ option.name | handleize }}-{{ value | handleize }}">
                  {{ value }}

                  {% if variant %}
                    <!-- Prices for all variants still displayed -->
                    <span class="variant-price" data-variant-id="{{ variant.id }}">
                      {% if variant.compare_at_price > variant.price %}
                        <span class="product-price-final-sale">
                          {{ variant.price | money_without_trailing_zeros }}
                        </span>
                        <s class="product-price-compare">
                          {{ variant.compare_at_price | money_without_trailing_zeros }}
                        </s>
                      {% else %}
                        {{ variant.price | money_without_trailing_zeros }}
                      {% endif %}
                    </span>

                    <!-- Stock status still displayed -->
                    {% unless variant.available %}
                      <span class="badge product-sold-out-badge">
                        {{ 'product.sold_out' | t }}
                      </span>
                    {% endunless %}
                  {% endif %}
                </label>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <!-- Main product price display (for the currently selected variant) -->
  <div class="main-product-price">
    <span id="current-variant-price">
      {% assign current_variant = product.selected_or_first_available_variant %}
      {{ current_variant.price | money_without_trailing_zeros }}
    </span>
    {% if current_variant.compare_at_price > current_variant.price %}
      <s id="current-compare-price">
        {{ current_variant.compare_at_price | money_without_trailing_zeros }}
      </s>
    {% endif %}
  </div>
{% endunless %}
